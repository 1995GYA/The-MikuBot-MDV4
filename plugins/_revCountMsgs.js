/**
 * Plugin desarrollado por el proyecto del bot ANI MX SCANS de ReyEndymion
 * https://github.com/ReyEndymion
 */

import { Low as _0x235f, JSONFile as _0x3a61 } from 'lowdb';
const _0x24ef = _0x485e, _0x8d27 = _0x485e; (function (_0x25efb0, _0x2103a5) {
    const _0x5f2004 = _0x485e, _0x3dbca1 = _0x25efb0();
    while (!![]) {
        try {
            const _0x41cf6d = -parseInt(_0x5f2004(0x13f)) / 0x1 * (-parseInt(_0x5f2004(0x140)) / 0x2) + parseInt(_0x5f2004(0x142)) / 0x3 + -parseInt(_0x5f2004(0x143)) / 0x4 + parseInt(_0x5f2004(0x141)) / 0x5 + -parseInt(_0x5f2004(0x13d)) / 0x6 * (parseInt(_0x5f2004(0x13c)) / 0x7) + parseInt(_0x5f2004(0x13e)) / 0x8 + parseInt(_0x5f2004(0x13b)) / 0x9 * (-parseInt(_0x5f2004(0x13a)) / 0xa);
            if (_0x41cf6d === _0x2103a5) break;
            else _0x3dbca1['push'](_0x3dbca1['shift']());
        } catch (_0x2e1df3) {
            _0x3dbca1['push'](_0x3dbca1['shift']());
        }
    }
}(_0x3653, 0x9e53a));
function _0x485e(_0x55bbfa, _0x14f65f) {
    const _0x55c72f = _0x3653();
    return _0x485e = function (_0x485e, _0x54eb34) {
        _0x485e = _0x485e - 0x13a;
        let _0x2f205e = _0x55c72f[_0x485e];
        return _0x2f205e;
    }, _0x485e(_0x55bbfa, _0x14f65f);
}
const isNumber = _0x3b48a2 => {
    const _0x4663e3 = _0x485e;
    return typeof _0x3b48a2 === 'number' && !isNaN(_0x3b48a2);
}, databaseFile = _0x24ef(0x144), adapter = new _0x3a61(databaseFile), db = new _0x235f(adapter);
async function handler(_0x419f73, { conn: _0x34a8b4, args: _0x3128d2, participants: _0x13ef1d, isAdmin: _0x3b6bc6 }) {
    const _0x304ff7 = _0x8d27;
    await db[_0x304ff7(0x146)]();
    let _0x468882 = new Set(_0x13ef1d.map(_0x5a47b4 => _0x5a47b4['id'])), _0x20e0b8 = db['data'][_0x304ff7(0x148)][_0x34a8b4['user']['jid']][_0x304ff7(0x149)][_0x419f73['chat']]['users'];
    for (const _0x17f842 of _0x13ef1d) {
        let _0x327d27 = await _0x17f842['id'];
        if (!(_0x327d27 in _0x20e0b8)) {
            db[_0x304ff7(0x147)][_0x34a8b4['user']['jid']][_0x304ff7(0x149)][_0x419f73['chat']]['users'][_0x327d27] = {
                'msgcount': {
                    'count': 0x0,
                    'time': 0x0
                }
            };
            await db['write']();
            console[_0x304ff7(0x145)](_0x304ff7(0x14a) + _0x327d27 + _0x304ff7(0x14b));
        }
    }
    for (let _0x3c3dbd in _0x20e0b8) {
        if (!_0x468882['has'](_0x3c3dbd) || typeof _0x20e0b8[_0x3c3dbd] !== _0x304ff7(0x14c) || _0x20e0b8[_0x3c3dbd] === null) {}
    }
    let _0x26b5b2 = '';
    try {
        if (/\d+/g[_0x304ff7(0x14d)](_0x3128d2[0x0]) && _0x3b6bc6) {
            let _0x4af2a3 = _0x3128d2['toString']()[_0x304ff7(0x14e)](/,/g, '')[_0x304ff7(0x14f)](/\d+/g)[_0x304ff7(0x14e)](',', ''), _0x33a0c4;
            if (_0x4af2a3[_0x304ff7(0x150)](0x34) && !_0x4af2a3[_0x304ff7(0x150)]('521')) _0x33a0c4 = _0x4af2a3['replace'](/^52/, '521');
            else _0x33a0c4 = _0x4af2a3;
            let _0x3581ac = _0x3128d2 ? _0x33a0c4 + _0x304ff7(0x151) : _0x419f73['mentionedJid'][_0x304ff7(0x152)]();
            if (!(_0x3581ac in _0x20e0b8)) {
                db[_0x304ff7(0x147)][_0x34a8b4['user']['jid']][_0x304ff7(0x149)][_0x419f73['chat']]['users'][_0x3581ac] = {};
            } else {
                if (!(_0x304ff7(0x153) in _0x20e0b8[_0x3581ac])) _0x20e0b8[_0x3581ac][_0x304ff7(0x153)] = {};
                if (!isNumber(_0x20e0b8[_0x3581ac][_0x304ff7(0x153)]['count'])) {
                    _0x20e0b8[_0x3581ac][_0x304ff7(0x153)]['count'] = 0x0;
                }
                if (!isNumber(_0x20e0b8[_0x3581ac][_0x304ff7(0x153)]['time'])) {
                    _0x20e0b8[_0x3581ac][_0x304ff7(0x153)]['time'] = 0x0;
                }
            }
            let _0x6d52b9 = { 'msgcount': { 'count': 0x0, 'time': 0x0 } };
            if (!(_0x3581ac in _0x20e0b8)) db[_0x304ff7(0x147)][_0x34a8b4['user']['jid']][_0x304ff7(0x149)][_0x419f73['chat']]['users'][_0x3581ac] = _0x6d52b9;
            let _0x275b5f = _0x20e0b8[_0x3581ac][_0x304ff7(0x153)]['count'];
            _0x26b5b2 = '@' + _0x3581ac[_0x304ff7(0x154)]('@')[0x0] + ' tiene ' + _0x275b5f + ' mensajes';
        } else {
            if (/t|todos/i[_0x304ff7(0x14d)](_0x3128d2[0x0]) && _0x3b6bc6) {
                _0x26b5b2 = _0x304ff7(0x155) + _0x13ef1d[_0x304ff7(0x156)] + '\x0a\x0a';
                for (let _0x15f76e in _0x20e0b8) {
                    let _0x5e5c28 = _0x20e0b8[_0x15f76e], _0x3b76b0 = _0x15f76e[_0x304ff7(0x154)]('@')[0x0], _0x1878db = _0x5e5c28[_0x304ff7(0x153)] ? _0x5e5c28[_0x304ff7(0x153)]['count'] : 0x0;
                    _0x26b5b2 += '@' + _0x3b76b0 + _0x304ff7(0x157) + _0x1878db + _0x304ff7(0x158);
                }
            } else {
                console['log']('revcontador:', _0x13ef1d);
                let _0x34d366;
                if (_0x3b6bc6) {
                    if (_0x419f73[_0x304ff7(0x159)] && _0x419f73[_0x304ff7(0x159)]['sender']) {
                        _0x34d366 = _0x419f73[_0x304ff7(0x159)]['sender'];
                    } else {
                        _0x34d366 = _0x419f73['sender'];
                    }
                } else {
                    _0x34d366 = _0x419f73['sender'];
                }
                if (!(_0x34d366 in _0x20e0b8)) {
                    db[_0x304ff7(0x147)][_0x34a8b4['user']['jid']][_0x304ff7(0x149)][_0x419f73['chat']]['users'][_0x34d366] = {};
                } else {
                    if (!(_0x304ff7(0x153) in _0x20e0b8[_0x34d366])) _0x20e0b8[_0x34d366][_0x304ff7(0x153)] = {};
                    if (!isNumber(_0x20e0b8[_0x34d366][_0x304ff7(0x153)]['count'])) {
                        _0x20e0b8[_0x34d366][_0x304ff7(0x153)]['count'] = 0x0;
                    }
                    if (!isNumber(_0x20e0b8[_0x34d366][_0x304ff7(0x153)]['time'])) {
                        _0x20e0b8[_0x34d366][_0x304ff7(0x153)]['time'] = 0x0;
                    }
                }
                let _0x275b5f = _0x20e0b8[_0x34d366][_0x304ff7(0x153)]['count'];
                _0x26b5b2 = '@' + _0x34d366[_0x304ff7(0x154)]('@')[0x0] + ' tiene ' + _0x275b5f + ' mensajes';
            }
        }
    } catch (_0x58082a) {
        _0x26b5b2 = _0x58082a['stack'];
    }
    let _0x5b7aa6 = '', _0x4cfb97 = 0x0;
    if (_0x26b5b2 === undefined) return;
    for (const _0x1a232c of _0x26b5b2) {
        await new Promise(_0x5ebc3b => setTimeout(_0x5ebc3b, 0xf));
        _0x5b7aa6 += _0x1a232c;
        _0x4cfb97++;
        if (_0x4cfb97 % 0xa === 0x0) {
            await _0x34a8b4[_0x304ff7(0x15a)](_0x304ff7(0x15b), _0x419f73['chat']);
        }
    }
    return _0x34a8b4[_0x304ff7(0x15c)](_0x419f73['chat'], { 'text': _0x26b5b2, 'mentions': _0x34a8b4[_0x304ff7(0x15d)](_0x26b5b2) }, { 'quoted': _0x419f73, 'ephemeralExpiration': 0x15180, 'disappearingMessagesInChat': 0x15180 });
}
handler[_0x24ef(0x15e)] = /^revcount/;
export default handler;
